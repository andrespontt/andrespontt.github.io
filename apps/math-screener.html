<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Math Screener ‚Äî Unit 1</title>
  <meta name="theme-color" content="#1e1b4b" />
  <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiTWF0aCBTY3JlZW5lciIsInNob3J0X25hbWUiOiJNYXRoIiwiZGlzcGxheSI6InN0YW5kYWxvbmUiLCJiYWNrZ3JvdW5kX2NvbG9yIjoiIzFhMTQ0NyIsInRoZW1lX2NvbG9yIjoiIzFlMWI0YiIsImljb25zIjpbeyJzcmMiOiJkYXRhOmltYWdlL3N2Zyt4bWwsJTNDc3ZnIHhtbG5zPSdodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2Zycgdmlld0JveD0nMCAwIDEwMCAxMDAnJTNFJTNDcmVjdCB3aWR0aD0nMTAwJyBoZWlnaHQ9JzEwMCcgZmlsbD0nJTIzN2M3ZGZmJy8lM0UlM0N0ZXh0IHg9JzUwJyB5PSc2NScgZm9udC1zaXplPSc1MCcgZm9udC1mYW1pbHk9J0FyaWFsJyBmaWxsPSdibGFjaycgdGV4dC1hbmNob3I9J21pZGRsZSclM0UxJTNDL3RleHQlM0UlM0Mvc3ZnJTNFIiwidHlwZSI6ImltYWdlL3N2Zyt4bWwiLCJzaXplcyI6IjUxMng1MTIifV19" />
  <style>
    :root {
      --bg: #1a1447;
      --bg2: #231858;
      --card: #2d1f6b;
      --fg: #f3f0ff;
      --muted: #c4b5fd;
      --accent: #a78bfa;
      --ok: #86efac;
      --bad: #fca5a5;
      --border: rgba(167, 139, 250, 0.2);
      --shadow: 0 14px 40px rgba(10, 5, 30, 0.4);
    }
    
    * { box-sizing: border-box; }
    
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
    }
    
    body {
      color: var(--fg);
      font-family: ui-rounded, system-ui, -apple-system, sans-serif;
      background: linear-gradient(180deg, var(--bg), var(--bg2));
      -webkit-font-smoothing: antialiased;
    }

    .app {
      min-height: 100vh;
      max-width: 900px;
      margin: 0 auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .title {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo {
      width: 40px;
      height: 40px;
      border-radius: 12px;
      background: linear-gradient(135deg, #a78bfa, #c4b5fd);
      box-shadow: 0 4px 12px rgba(167, 139, 250, 0.3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      font-weight: 900;
      color: #1a1447;
    }

    h1 {
      margin: 0;
      font-size: clamp(18px, 4vw, 24px);
      font-weight: 800;
    }

    .pill {
      background: rgba(167, 139, 250, 0.15);
      border: 1px solid var(--border);
      border-radius: 999px;
      padding: 8px 16px;
      font-weight: 700;
      font-size: 14px;
      color: var(--accent);
    }

    .card {
      background: linear-gradient(135deg, #2d1f6b, #241858);
      border: 1px solid var(--border);
      border-radius: 20px;
      box-shadow: var(--shadow);
      padding: 24px;
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .prompt {
      color: var(--fg);
      font-weight: 700;
      font-size: clamp(16px, 3vw, 20px);
      text-align: center;
      padding: 12px;
      background: rgba(167, 139, 250, 0.1);
      border-radius: 12px;
    }

    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 16px;
      min-height: 200px;
    }

    .row {
      display: flex;
      gap: 12px;
      align-items: center;
      flex-wrap: wrap;
      justify-content: center;
    }

    .num-btn {
      min-width: 100px;
      padding: 20px;
      background: rgba(167, 139, 250, 0.15);
      border: 2px solid var(--accent);
      color: var(--fg);
      border-radius: 16px;
      font-weight: 900;
      font-size: 32px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .num-btn:hover {
      background: rgba(167, 139, 250, 0.25);
      transform: scale(1.05);
    }

    .num-btn.correct {
      background: rgba(134, 239, 172, 0.2);
      border-color: var(--ok);
    }

    .num-btn.wrong {
      background: rgba(252, 165, 165, 0.2);
      border-color: var(--bad);
    }

    input[type="number"] {
      appearance: none;
      -moz-appearance: textfield;
      background: rgba(167, 139, 250, 0.1);
      color: var(--fg);
      border: 2px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      font-weight: 900;
      font-size: 24px;
      width: 100px;
      text-align: center;
    }

    input[type="number"]::-webkit-outer-spin-button,
    input[type="number"]::-webkit-inner-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }

    .domino {
      display: grid;
      grid-template-rows: 1fr auto 1fr auto;
      gap: 12px;
      width: min(360px, 90vw);
      background: rgba(167, 139, 250, 0.1);
      border: 2px solid var(--border);
      border-radius: 20px;
      padding: 16px;
    }

    .half {
      border: 2px dashed rgba(167, 139, 250, 0.3);
      border-radius: 16px;
      display: grid;
      place-items: center;
      min-height: 140px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .half:hover {
      background: rgba(167, 139, 250, 0.05);
      border-color: var(--accent);
    }

    .pips {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      grid-template-rows: repeat(3, 1fr);
      gap: 8px;
      width: 100%;
      height: 100%;
      padding: 16px;
    }

    .pip {
      width: 20px;
      height: 20px;
      background: var(--accent);
      border-radius: 50%;
      justify-self: center;
      align-self: center;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
    }

    .helper {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      font-size: 14px;
    }

    .controls {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      flex-wrap: wrap;
    }

    .btn {
      background: rgba(167, 139, 250, 0.2);
      color: var(--fg);
      border: 2px solid var(--accent);
      border-radius: 12px;
      padding: 12px 24px;
      font-weight: 800;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .btn:hover {
      background: rgba(167, 139, 250, 0.3);
      transform: translateY(-2px);
    }

    .btn.primary {
      background: var(--accent);
      color: #1a1447;
    }

    .btn.primary:hover {
      background: #c4b5fd;
    }

    .feedback {
      min-height: 30px;
      text-align: center;
      font-weight: 800;
      font-size: 18px;
      padding: 12px;
      border-radius: 12px;
    }

    .good {
      color: var(--ok);
      background: rgba(134, 239, 172, 0.1);
    }

    .bad {
      color: var(--bad);
      background: rgba(252, 165, 165, 0.1);
    }

    @media (max-width: 600px) {
      .num-btn { min-width: 80px; font-size: 24px; }
      .card { padding: 16px; }
    }
  </style>
</head>
<body>
  <div class="app">
    <header>
      <div class="title">
        <div class="logo">1</div>
        <h1>Math Screener ‚Äî Unit 1</h1>
      </div>
      <div class="pill">Task <span id="step">1</span> / 6</div>
    </header>

    <section class="card">
      <div id="prompt" class="prompt"></div>
      <div id="content" class="content"></div>
      <div id="feedback" class="feedback"></div>
      <div class="controls">
        <button id="prev" class="btn">‚¨Ö Prev</button>
        <div style="display:flex; gap:12px;">
          <button id="check" class="btn primary">‚úì Check</button>
          <button id="next" class="btn">Next ‚û°</button>
        </div>
      </div>
    </section>
  </div>

  <script>
    const SAVE_KEY = 'math_screener_v1';
    const els = {
      step: document.getElementById('step'),
      prompt: document.getElementById('prompt'),
      content: document.getElementById('content'),
      feedback: document.getElementById('feedback'),
      prev: document.getElementById('prev'),
      next: document.getElementById('next'),
      check: document.getElementById('check')
    };

    const state = {
      i: 0,
      t1: { seq: [], answers: [] },
      t2: { a: 0, b: 0, pick: null },
      t3: { a: 0, b: 0, pick: null },
      t4: { n: 0, added: 0 },
      t5: { top: 0, bottomAdded: 0, missing: '' },
      t6: { ans: '' },
      results: {}
    };

    function save() {
      try {
        localStorage.setItem(SAVE_KEY, JSON.stringify(state));
      } catch (e) {}
    }

    function load() {
      try {
        const raw = localStorage.getItem(SAVE_KEY);
        if (raw) {
          const s = JSON.parse(raw);
          Object.assign(state, s);
        }
      } catch (e) {}
    }

    function rng(min, max) {
      return Math.floor(Math.random() * (max - min + 1)) + min;
    }

    function buildT1() {
      const start = rng(1, 10);
      const seq = Array.from({ length: 10 }, (_, i) => start + i);
      const blanks = new Set();
      while (blanks.size < 2) {
        blanks.add(rng(1, 8));
      }
      blanks.forEach(i => seq[i] = '__');
      state.t1.seq = seq;
      state.t1.answers = [];
      save();
      return seq;
    }

    function ensureT2() {
      if (!state.t2.a && !state.t2.b) {
        state.t2.a = rng(0, 20);
        state.t2.b = rng(0, 20);
        if (state.t2.a === state.t2.b) state.t2.b = (state.t2.b + 1) % 21;
        save();
      }
      return state.t2;
    }

    function ensureT3() {
      if (!state.t3.a && !state.t3.b) {
        state.t3.a = rng(0, 20);
        state.t3.b = rng(0, 20);
        if (state.t3.a === state.t3.b) state.t3.b = (state.t3.b + 2) % 21;
        save();
      }
      return state.t3;
    }

    function ensureT4() {
      if (!state.t4.n) {
        state.t4.n = rng(0, 4);
        save();
      }
      return state.t4.n;
    }

    function ensureT5() {
      if (!state.t5.top && state.t5.top !== 0) {
        state.t5.top = rng(0, 9);
        save();
      }
      return state.t5;
    }

    function pips(n) {
      const grid = document.createElement('div');
      grid.className = 'pips';
      const patterns = [
        [0, 0, 0, 0, 0, 0, 0, 0, 0], // 0
        [0, 0, 0, 0, 1, 0, 0, 0, 0], // 1
        [1, 0, 0, 0, 0, 0, 0, 0, 1], // 2
        [1, 0, 0, 0, 1, 0, 0, 0, 1], // 3
        [1, 0, 1, 0, 0, 0, 1, 0, 1], // 4
        [1, 0, 1, 0, 1, 0, 1, 0, 1], // 5
        [1, 0, 1, 1, 0, 1, 1, 0, 1], // 6
        [1, 1, 1, 0, 1, 0, 1, 1, 1], // 7
        [1, 1, 1, 1, 0, 1, 1, 1, 1], // 8
        [1, 1, 1, 1, 1, 1, 1, 1, 1], // 9
        [1, 1, 1, 1, 1, 1, 1, 1, 1]  // 10
      ];
      const idx = Math.max(0, Math.min(n, 10));
      patterns[idx].forEach(v => {
        const dot = document.createElement('div');
        if (v) dot.className = 'pip';
        grid.appendChild(dot);
      });
      return grid;
    }

    function dominoUI(existing, target, onChange) {
      const wrap = document.createElement('div');
      wrap.className = 'domino';

      const top = document.createElement('div');
      top.className = 'half';
      top.style.cursor = 'default';
      top.appendChild(pips(existing));

      const topLabel = document.createElement('div');
      topLabel.className = 'helper';
      topLabel.innerHTML = `<span class="pill">Starting: ${existing}</span>`;

      const bottom = document.createElement('div');
      bottom.className = 'half';

      const bottomLabel = document.createElement('div');
      bottomLabel.className = 'helper';
      bottomLabel.innerHTML = `<span class="pill">Tap to add dots</span><span class="pill">Goal: ${target}</span>`;

      let added = state.i === 4 ? (state.t5.bottomAdded || 0) : (state.t4.added || 0);

      function redraw() {
        bottom.replaceChildren(pips(added));
        onChange(added);
      }

      bottom.addEventListener('click', () => {
        if (existing + added < target) {
          added++;
          redraw();
        }
      });

      bottom.addEventListener('contextmenu', (e) => {
        e.preventDefault();
        if (added > 0) {
          added--;
          redraw();
        }
      });

      redraw();

      wrap.appendChild(top);
      wrap.appendChild(topLabel);
      wrap.appendChild(bottom);
      wrap.appendChild(bottomLabel);

      return wrap;
    }

    function highlightPicks(container, picked, correct) {
      Array.from(container.children).forEach(btn => {
        btn.classList.remove('correct', 'wrong');
        const val = Number(btn.textContent);
        if (val === picked) {
          btn.classList.add(picked === correct ? 'correct' : 'wrong');
        }
      });
    }

    function render() {
      els.step.textContent = String(state.i + 1);
      els.feedback.textContent = '';
      els.feedback.className = 'feedback';
      els.content.innerHTML = '';

      const c = els.content;

      if (state.i === 0) {
        const seq = state.t1.seq.length ? state.t1.seq : buildT1();
        els.prompt.textContent = 'Count forward and fill in the missing numbers.';
        const row = document.createElement('div');
        row.className = 'row';
        seq.forEach((cell, idx) => {
          if (cell === '__') {
            const inp = document.createElement('input');
            inp.type = 'number';
            inp.placeholder = '?';
            inp.value = state.t1.answers[idx] || '';
            inp.addEventListener('input', () => {
              state.t1.answers[idx] = inp.value;
              save();
            });
            row.appendChild(inp);
          } else {
            const span = document.createElement('span');
            span.className = 'pill';
            span.textContent = String(cell);
            row.appendChild(span);
          }
        });
        c.appendChild(row);
      } else if (state.i === 1) {
        els.prompt.textContent = 'Tap the bigger number.';
        const { a, b } = ensureT2();
        const row = document.createElement('div');
        row.className = 'row';
        [a, b].forEach(n => {
          const btn = document.createElement('button');
          btn.className = 'num-btn';
          btn.textContent = String(n);
          btn.addEventListener('click', () => {
            state.t2.pick = n;
            save();
            highlightPicks(row, n, Math.max(a, b));
          });
          row.appendChild(btn);
        });
        c.appendChild(row);
        if (state.t2.pick != null) {
          highlightPicks(row, state.t2.pick, Math.max(a, b));
        }
      } else if (state.i === 2) {
        els.prompt.textContent = 'Tap the smaller number.';
        const { a, b } = ensureT3();
        const row = document.createElement('div');
        row.className = 'row';
        [a, b].forEach(n => {
          const btn = document.createElement('button');
          btn.className = 'num-btn';
          btn.textContent = String(n);
          btn.addEventListener('click', () => {
            state.t3.pick = n;
            save();
            highlightPicks(row, n, Math.min(a, b));
          });
          row.appendChild(btn);
        });
        c.appendChild(row);
        if (state.t3.pick != null) {
          highlightPicks(row, state.t3.pick, Math.min(a, b));
        }
      } else if (state.i === 3) {
        els.prompt.textContent = 'Count the dots, then add more to make 5.';
        const n = ensureT4();
        c.appendChild(dominoUI(n, 5, (added) => {
          state.t4.added = added;
          save();
        }));
      } else if (state.i === 4) {
        els.prompt.textContent = 'Add dots on bottom to make 10. Write the missing number.';
        const { top } = ensureT5();
        c.appendChild(dominoUI(top, 10, (added) => {
          state.t5.bottomAdded = added;
          save();
        }));
        const ansRow = document.createElement('div');
        ansRow.className = 'row';
        ansRow.style.marginTop = '16px';
        const label = document.createElement('span');
        label.className = 'pill';
        label.textContent = 'Missing number:';
        ansRow.appendChild(label);
        const inp = document.createElement('input');
        inp.type = 'number';
        inp.placeholder = '?';
        inp.value = state.t5.missing || '';
        inp.addEventListener('input', () => {
          state.t5.missing = inp.value;
          save();
        });
        ansRow.appendChild(inp);
        c.appendChild(ansRow);
      } else if (state.i === 5) {
        els.prompt.textContent = 'There were 5 dominos on the table. 2 fell on the floor. How many are left?';
        const row = document.createElement('div');
        row.className = 'row';
        const inp = document.createElement('input');
        inp.type = 'number';
        inp.placeholder = 'Answer';
        inp.value = state.t6.ans || '';
        inp.addEventListener('input', () => {
          state.t6.ans = inp.value;
          save();
        });
        row.appendChild(inp);
        c.appendChild(row);
      }
    }

    function check() {
      let ok = false;
      let msg = '';

      if (state.i === 0) {
        const seq = state.t1.seq;
        const ans = state.t1.answers;
        let good = true;
        seq.forEach((cell, idx) => {
          if (cell === '__') {
            const want = seq[idx - 1] !== '__' ? seq[idx - 1] + 1 : seq[idx + 1] - 1;
            good = good && Number(ans[idx]) === want;
          }
        });
        ok = good;
        msg = good ? 'üéâ Great counting!' : '‚ùå Some blanks are incorrect.';
      } else if (state.i === 1) {
        const { a, b, pick } = state.t2;
        ok = pick === Math.max(a, b);
        msg = ok ? '‚úì Correct!' : '‚ùå Try again: tap the bigger number.';
      } else if (state.i === 2) {
        const { a, b, pick } = state.t3;
        ok = pick === Math.min(a, b);
        msg = ok ? '‚úì Nice job!' : '‚ùå Try again: tap the smaller number.';
      } else if (state.i === 3) {
        const have = state.t4.n;
        const add = state.t4.added;
        ok = have + add === 5;
        msg = ok ? 'üéâ You made 5!' : '‚ùå Keep adding dots to make 5.';
      } else if (state.i === 4) {
        const have = state.t5.top;
        const add = state.t5.bottomAdded;
        const miss = Number(state.t5.missing || NaN);
        ok = have + add === 10 && miss === 10 - have;
        msg = ok ? 'üéâ You made 10!' : '‚ùå Add dots and write the missing number.';
      } else if (state.i === 5) {
        ok = Number(state.t6.ans || NaN) === 3;
        msg = ok ? '‚úì Correct: 3 dominos left!' : 'üí° Hint: 5 - 2 = ?';
      }

      els.feedback.textContent = msg;
      els.feedback.className = 'feedback ' + (ok ? 'good' : 'bad');
      state.results[state.i] = ok;
      save();
      return ok;
    }

    function next() {
      if (state.i < 5) {
        state.i++;
        maybeInit();
        render();
      }
    }

    function prev() {
      if (state.i > 0) {
        state.i--;
        render();
      }
    }

    function maybeInit() {
      if (state.i === 0 && (!state.t1.seq || !state.t1.seq.length)) buildT1();
      if (state.i === 1) ensureT2();
      if (state.i === 2) ensureT3();
      if (state.i === 3) ensureT4();
      if (state.i === 4) ensureT5();
    }

    els.check.addEventListener('click', check);
    els.next.addEventListener('click', () => {
      if (check()) next();
    });
    els.prev.addEventListener('click', prev);

    // Init
    load();
    maybeInit();
    render();

    // PWA Service Worker Registration
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('data:text/javascript;base64,c2VsZi5hZGRFdmVudExpc3RlbmVyKCdpbnN0YWxsJywgZSA9PiBzZWxmLnNraXBXYWl0aW5nKCkpOwpzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ2FjdGl2YXRlJywgZSA9PiBzZWxmLmNsaWVudHMuY2xhaW0oKSk7CnNlbGYuYWRkRXZlbnRMaXN0ZW5lcignZmV0Y2gnLCBlID0+IGUucmVzcG9uZFdpdGgoZmV0Y2goZS5yZXF1ZXN0KSkpOw==');
    }
  </script>
</body>
</html>