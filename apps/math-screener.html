<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Math Screener — Unit 1</title>
  <meta name="color-scheme" content="dark light" />
  <style>
    :root{
      --bg:#0b1020; --bg2:#0f1426; --card:#12172c; --fg:#e6eefc; --muted:#8aa0c8; --accent:#7dd3fc; --ok:#86efac; --bad:#fca5a5; --border:rgba(255,255,255,.12);
      --shadow:0 14px 40px rgba(2,6,23,.22);
    }
    html,body{height:100%}
    *{box-sizing:border-box}
    body{margin:0; color:var(--fg); font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
      background: linear-gradient(180deg, var(--bg), var(--bg2));}

    .app{ min-height:100vh; width:min(980px, 96vw); margin:0 auto; padding:12px; display:grid; grid-template-rows:auto 1fr auto; gap:12px; }
    nav#site-nav{ position: sticky; top: 8px; background: rgba(255,255,255,.04); border:1px solid var(--border); border-radius:12px; padding:8px 10px; backdrop-filter: blur(10px); }
    nav#site-nav ul{ list-style:none; display:flex; gap:10px; margin:0; padding:0; flex-wrap:wrap; justify-content:center; }
    nav#site-nav a{ color:var(--fg); text-decoration:none; font-weight:800; padding:6px 10px; border-radius:10px; }
    nav#site-nav a[aria-current="page"]{ color:#081a14; background:var(--accent); }

    header{ display:flex; align-items:center; justify-content:space-between; gap:10px; flex-wrap:wrap; }
    .title{ display:flex; align-items:center; gap:10px; }
    .logo{ width:38px; height:38px; border-radius:12px; background: radial-gradient(circle at 30% 30%, var(--accent), #b8f3ff); box-shadow: inset 0 0 0 3px rgba(255,255,255,.85), 0 10px 28px rgba(2,6,23,.28) }
    h1{ margin:0; font-size: clamp(18px, 2.4vw, 26px); }
    .pill{ background:#0a1430; border:1px solid var(--border); border-radius:999px; padding:8px 12px; font-weight:800; color:#c3d7fb; }

    .card{ background: linear-gradient(180deg, #0d1329, #0b1328); border:1px solid var(--border); border-radius:16px; box-shadow:var(--shadow); padding:16px; display:grid; gap:12px; }

    .prompt{ color:#dbeafe; font-weight:800; }
    .content{ display:grid; gap:12px; }
    .row{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .num-btn{ min-width:68px; flex:1; text-align:center; padding:14px 12px; background:#0f274f; border:1px solid #3b82f6; color:#e9f1ff; border-radius:12px; font-weight:900; font-size:18px; }
    .num-btn.correct{ background:#103b2a; border-color:#16a34a; }
    .num-btn.wrong{ background:#3a0e0e; border-color:#b91c1c; }

    .inputs{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    input[type="number"], input[type="text"]{ appearance:none; background:#0f162d; color:var(--fg); border:1px solid var(--border); border-radius:10px; padding:10px 12px; font-weight:800; width:80px; text-align:center; }

    .domino{ display:grid; grid-template-rows: 1fr 1fr; gap:8px; width:min(360px, 92vw); background:#0a1630; border:1px solid var(--border); border-radius:14px; padding:12px; }
    .half{ position:relative; border:1px dashed rgba(255,255,255,.15); border-radius:10px; display:grid; place-items:center; min-height:120px; }
    .pips{ display:grid; grid-template-columns: repeat(3, 1fr); grid-template-rows: repeat(3, 1fr); gap:6px; width:100%; height:100%; padding:10px; }
    .pip{ width:18px; height:18px; background:#e5eefc; border-radius:999px; justify-self:center; align-self:center; box-shadow: 0 1px 0 rgba(0,0,0,.35); }
    .ghost{ background: transparent; border:1px solid rgba(255,255,255,.18); color:var(--fg); border-radius:12px; padding:10px 14px; font-weight:800; }

    .controls{ display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; }
    .btn{ background:#0d2340; color:var(--fg); border:1px solid var(--border); border-radius:12px; padding:10px 14px; font-weight:800; }
    .btn.primary{ background:#0d2340 }
    .btn.secondary{ background:#0a1430 }

    .feedback{ min-height:24px; color:var(--muted); font-weight:800; }
    .good{ color:#86efac }
    .bad{ color:#fca5a5 }

    footer{ display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:8px; }

    @media (max-width:560px){ .num-btn{ min-width:120px; } .half{ min-height:100px; } }
  </style>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-2PFGZZBZ0B"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments)}; gtag('js', new Date()); gtag('config','G-2PFGZZBZ0B');
  </script>
</head>
<body>
  <div class="app" role="application" aria-label="Math Screener">
    <nav id="site-nav">
      <noscript>
        <ul>
          <li><a href="../index.html">Home</a></li>
          <li><a href="../pages/experiments.html">Experiments</a></li>
          <li><a href="../pages/music.html">Music</a></li>
          <li><a href="../pages/bio.html">About Me</a></li>
          <li><a href="type-quest.html">Games</a></li>
          <li><a href="perfect-pitch.html">Perfect Pitch</a></li>
          <li><a href="pomodoro.html">Pomodoro</a></li>
          <li><a href="math-screener.html">Math Screener</a></li>
        </ul>
      </noscript>
    </nav>

    <header>
      <div class="title">
        <div class="logo" aria-hidden="true"></div>
        <h1>Math Screener — Unit 1</h1>
      </div>
      <div class="pill">Task <span id="step">1</span> / 6</div>
    </header>

    <section class="card" aria-live="polite" aria-atomic="true">
      <div id="prompt" class="prompt"></div>
      <div id="content" class="content"></div>
      <div id="feedback" class="feedback" role="status"></div>
      <div class="controls">
        <button id="prev" class="btn secondary">⬅️ Prev</button>
        <div style="display:flex; gap:8px;">
          <button id="check" class="btn primary">✅ Check</button>
          <button id="next" class="btn">➡️ Next</button>
        </div>
      </div>
    </section>

    <footer>
      <div class="pill">Mobile-friendly. Progress saves locally.</div>
      <a class="ghost" href="../prompt-screener.md" target="_blank" rel="noopener">Spec</a>
    </footer>
  </div>

  <script src="../assets/nav.js" defer></script>
  <script>
    const SAVE_KEY = 'math_screener_v1';
    const els = { step: document.getElementById('step'), prompt: document.getElementById('prompt'), content: document.getElementById('content'), feedback: document.getElementById('feedback'), prev: document.getElementById('prev'), next: document.getElementById('next'), check: document.getElementById('check') };
    const state = { i: 0, // 0..5 tasks
      t1: { seq: [], answers: [] }, t2: { a:0, b:0, pick:null }, t3: { a:0, b:0, pick:null }, t4: { n:0, added:0 }, t5: { top:0, bottomAdded:0, missing:'' }, t6: { a:5, b:2, ans:'' }, results: {} };

    function save(){ try{ localStorage.setItem(SAVE_KEY, JSON.stringify(state)); }catch(e){} }
    function load(){ try{ const raw=localStorage.getItem(SAVE_KEY); if(raw){ const s=JSON.parse(raw); Object.assign(state, s); } }catch(e){} }

    function rng(min,max){ return Math.floor(Math.random()*(max-min+1))+min; }

    // ===== Task renderers =====
    function render(){ els.step.textContent = String(state.i+1); els.feedback.textContent=''; els.content.innerHTML='';
      const c = els.content; let html='';
      if(state.i===0){ // Counting forward with blanks
        const seq = state.t1.seq.length ? state.t1.seq : buildT1();
        els.prompt.textContent = 'Count forward and fill in the missing numbers.';
        const row = document.createElement('div'); row.className='row';
        seq.forEach((cell, idx)=>{
          if(cell==='__'){
            const inp = document.createElement('input'); inp.type='number'; inp.inputMode='numeric'; inp.pattern='[0-9]*'; inp.placeholder='?'; inp.value = state.t1.answers[idx]||''; inp.style.width='70px'; inp.addEventListener('input', ()=>{ state.t1.answers[idx]=inp.value; save(); }); row.appendChild(inp);
          } else {
            const span = document.createElement('span'); span.className='pill'; span.textContent=String(cell); row.appendChild(span);
          }
        });
        c.appendChild(row);
      }
      else if(state.i===1){ // Greater number
        els.prompt.textContent = 'Circle the bigger number.';
        const {a,b} = ensureT2();
        const row = document.createElement('div'); row.className='row';
        [a,b].forEach((n, idx)=>{
          const btn = document.createElement('button'); btn.className='num-btn'; btn.textContent=String(n); btn.addEventListener('click', ()=>{ state.t2.pick = n; save(); highlightPicks(row, n, Math.max(a,b)); }); row.appendChild(btn);
        });
        c.appendChild(row);
        if(state.t2.pick!=null) highlightPicks(row, state.t2.pick, Math.max(a,b));
      }
      else if(state.i===2){ // Smaller number
        els.prompt.textContent = 'Circle the smaller number.';
        const {a,b} = ensureT3();
        const row = document.createElement('div'); row.className='row';
        [a,b].forEach((n)=>{
          const btn = document.createElement('button'); btn.className='num-btn'; btn.textContent=String(n); btn.addEventListener('click', ()=>{ state.t3.pick = n; save(); highlightPicks(row, n, Math.min(a,b)); }); row.appendChild(btn);
        });
        c.appendChild(row);
        if(state.t3.pick!=null){ highlightPicks(row, state.t3.pick, Math.min(a,b)); }
      }
      else if(state.i===3){ // Make 5 (domino fill)
        els.prompt.textContent = 'Count dots, then add more to make 5.';
        const n = ensureT4();
        c.appendChild(dominoUI(n, 5, (added)=>{ state.t4.added = added; save(); }));
      }
      else if(state.i===4){ // Make 10 with dominos
        els.prompt.textContent = 'Add dots on bottom to make 10. Write the missing number.';
        const { top } = ensureT5();
        c.appendChild(dominoUI(top, 10, (added)=>{ state.t5.bottomAdded = added; save(); }, true));
        const ansRow = document.createElement('div'); ansRow.className='row';
        const label = document.createElement('span'); label.className='pill'; label.textContent='Missing number:'; ansRow.appendChild(label);
        const inp = document.createElement('input'); inp.type='number'; inp.inputMode='numeric'; inp.pattern='[0-9]*'; inp.placeholder='?'; inp.value=state.t5.missing||''; inp.addEventListener('input', ()=>{ state.t5.missing = inp.value; save(); }); ansRow.appendChild(inp);
        c.appendChild(ansRow);
      }
      else if(state.i===5){ // Word problem
        els.prompt.textContent = 'There were 5 dominos on the table. 2 fell on the floor. How many are left?';
        const row = document.createElement('div'); row.className='row';
        const inp = document.createElement('input'); inp.type='number'; inp.inputMode='numeric'; inp.pattern='[0-9]*'; inp.placeholder='Answer'; inp.value=state.t6.ans||''; inp.addEventListener('input', ()=>{ state.t6.ans=inp.value; save(); });
        row.appendChild(inp); c.appendChild(row);
      }
    }

    function buildT1(){ // sequence up to 20 with two blanks
      const start = rng(1, 10); // 10 numbers long
      const seq = Array.from({length:10}, (_,i)=> start+i);
      const blanks = new Set(); while(blanks.size<2){ blanks.add(rng(1,8)); }
      blanks.forEach(i=> seq[i] = '__'); state.t1.seq = seq; state.t1.answers = []; save(); return seq;
    }
    function ensureT2(){ if(!state.t2.a && !state.t2.b){ state.t2.a=rng(0,20); state.t2.b=rng(0,20); if(state.t2.a===state.t2.b) state.t2.b = (state.t2.b+1)%21; } return state.t2; }
    function ensureT3(){ if(!state.t3.a && !state.t3.b){ state.t3.a=rng(0,20); state.t3.b=rng(0,20); if(state.t3.a===state.t3.b) state.t3.b = (state.t3.b+2)%21; } return state.t3; }
    function ensureT4(){ if(!state.t4.n) state.t4.n = rng(0,5); return state.t4.n; }
    function ensureT5(){ if(!state.t5.top && state.t5.top!==0){ state.t5.top = rng(0,9); } return state.t5; }

    function highlightPicks(container, picked, correct){ Array.from(container.children).forEach(btn=>{ btn.classList.remove('correct','wrong'); const val=Number(btn.textContent); btn.classList.add(val===picked ? (picked===correct?'correct':'wrong') : ''); }); }

    // Domino UI helper
    function dominoUI(existing, target, onChange, split=false){
      const wrap = document.createElement('div'); wrap.className='domino';
      const top = document.createElement('div'); top.className='half'; top.appendChild(pips(existing));
      const bottom = document.createElement('div'); bottom.className='half'; const bottomP = pips(0); bottom.appendChild(bottomP);
      wrap.appendChild(top); wrap.appendChild(bottom);
      let added = split ? (state.t5.bottomAdded||0) : (state.t4.added||0);
      function redraw(){ bottom.replaceChildren(pips(added)); onChange(added); }
      bottom.addEventListener('click', ()=>{ if(existing + added < target){ added++; redraw(); } });
      // long-press to remove
      bottom.addEventListener('contextmenu', (e)=>{ e.preventDefault(); if(added>0){ added--; redraw(); } });
      redraw();
      // helper label
      const helper = document.createElement('div'); helper.className='row'; helper.style.justifyContent='space-between'; helper.style.marginTop='6px';
      const left = document.createElement('span'); left.className='pill'; left.textContent = `Have: ${existing}`; const right=document.createElement('span'); right.className='pill'; right.textContent = `Goal: ${target}`;
      helper.appendChild(left); helper.appendChild(right); wrap.appendChild(helper);
      return wrap;
    }
    function pips(n){ const grid = document.createElement('div'); grid.className='pips'; const pattern = [
      [0,0,0,0,0,0,0,0,0], // 0
      [0,0,0,0,1,0,0,0,0], // 1
      [1,0,0,0,0,0,0,0,1], // 2
      [1,0,0,0,1,0,0,0,1], // 3
      [1,0,1,0,0,0,1,0,1], // 4
      [1,0,1,0,1,0,1,0,1], // 5
      [1,0,1,1,0,1,1,0,1], // 6 (use full grid)
      [1,1,1,0,1,0,1,1,1], // 7
      [1,1,1,1,0,1,1,1,1], // 8
      [1,1,1,1,1,1,1,1,1], // 9
      [1,1,1,1,1,1,1,1,1]  // 10 -> cap
    ]; const idx = Math.max(0, Math.min(n, 10)); pattern[idx].forEach(v=>{ const dot=document.createElement('div'); if(v) dot.className='pip'; grid.appendChild(dot); }); return grid; }

    // ===== Checking logic =====
    function check(){ let ok=false, msg='';
      if(state.i===0){ const seq=state.t1.seq; const ans=state.t1.answers; let good=true; seq.forEach((cell,idx)=>{ if(cell==='__'){ const want = (seq[idx-1]!=="__" ? seq[idx-1]+1 : seq[idx+1]-1); good = good && (Number(ans[idx])===want); } }); ok=good; msg = good ? 'Great counting!' : 'Some blanks are incorrect.'; }
      else if(state.i===1){ const {a,b,pick} = state.t2; ok = (pick===Math.max(a,b)); msg = ok?'Correct!':'Try again: tap the bigger.'; }
      else if(state.i===2){ const {a,b,pick} = state.t3; ok = (pick===Math.min(a,b)); msg = ok?'Nice!':'Try again: tap the smaller.'; }
      else if(state.i===3){ const have=state.t4.n, add=state.t4.added; ok = (have+add===5); msg = ok?'You made 5!':'Keep adding dots to make 5.'; }
      else if(state.i===4){ const have=state.t5.top, add=state.t5.bottomAdded, miss=Number(state.t5.missing||NaN); ok = (have+add===10) && (miss===10-have); msg = ok?'You made 10!':'Add dots and write the missing number.'; }
      else if(state.i===5){ ok = (Number(state.t6.ans||NaN)===3); msg = ok?'Correct: 3 left.':'Hint: 5 - 2 = ?'; }
      els.feedback.textContent = msg; els.feedback.className = 'feedback ' + (ok?'good':'bad'); state.results[state.i]=ok; save(); return ok; }

    function next(){ if(state.i<5){ state.i++; maybeInit(); render(); } }
    function prev(){ if(state.i>0){ state.i--; render(); } }
    function maybeInit(){ if(state.i===0 && (!state.t1.seq || !state.t1.seq.length)) buildT1(); if(state.i===1) ensureT2(); if(state.i===2) ensureT3(); if(state.i===3) ensureT4(); if(state.i===4) ensureT5(); }

    els.check.addEventListener('click', check); els.next.addEventListener('click', ()=>{ if(check()) next(); }); els.prev.addEventListener('click', prev);

    // Init
    load(); maybeInit(); render();
  </script>
</body>
</html>

